<!DOCTYPE HTML>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>Billing History</title>

		<script src="resources/jquery-1.9.1.js" type="text/javascript"></script>
		<script type="text/javascript">
	var xAxisData = new Array();
	var yAxisData = new Array();
	var monthArray = new Array();
	var yearArray = new Array();
	$(function () {
		
		var form = $('#billingHistoryChartFrm');
	    #[[$]]#.ajax({
        	type: "POST",
			url: form.attr( 'action' ),
        	data: '',
        	success: function(response){
    			if(response.status == 'Pass'){
    				for(i =0 ; i < response.result.length ; i++){
						xAxisData[i] = response.result[i].month+'-'+response.result[i].year;
						yAxisData[i] = response.result[i].billAmount;
						monthArray[i] = response.result[i].month;
						yearArray[i] = response.result[i].year;
         			}
					generateChart();
                 }else{
                     $('#error').html("Please correct following errors: " + response.result);
                 }
				 
         	},
         	error: function(e){
            	alert('Error: ' + e);
         	}
    	});
    });
    
	function generateChart()
	{
		$('#container').highcharts({
            chart: {
                type: 'column'
            },
            title: {
                text: 'Billing History'
            },
            subtitle: {
                text: 'Source: cognizant.com'
            },
            xAxis: {
                categories: xAxisData
            },
            yAxis: {
                min: 0,
                title: {
                    text: 'Pound'
                }
            },
            tooltip: {
                shared: true
            },
            plotOptions: {
                column: {
                    pointPadding: 0.2,
                    borderWidth: 0
                },
				series: {
                    point: {
                        events: {
                            click:function() {
								openItemisedBil(monthArray[this.x], yearArray[this.x])
                            }
                        }
                    }
                }
            },
            series: [{
                name: 'Bill Amount',
                data: yAxisData,
				tooltip: {
                    valueSuffix: ' Pounds'
                }
            }]
        });
	}
	
	function openItemisedBil(month, year){
		var hidden = $('#monthlyBillURL');
		var url = hidden.attr( 'value' )+'/'+month+'/'+year+'.do';
		window.open(url, 'Itemised Bill', 'width=800, height=600, status=yes, menubar=no, scrollbars=yes, resizable=yes');
	} 
		</script>
		<link type="text/css" rel="stylesheet" href="resources/bootstrap/css/bootstrap.css"/>
		<link type="text/css" rel="stylesheet" href="resources/bootstrap/css/bootstrap-responsive.css"/>
	</head>
	<body>
    <script src="resources/highcharts.js"></script>
    <script src="resources/modules/exporting.js"></script>
	<ul class="nav nav-pills nav-stacked span">
		<li><a href="#springUrl('/home.do')"><i class="icon-home icon-black"></i>Home</a></li>
        <li><a href="#springUrl('/myBillDetails.do')">My Bill</a></li>
        <li class="active"><a href="#springUrl('/usageStatistics.do')">Usage Statistics</a></li>
        <li><a href="#springUrl('/otherNetworkConsumers.do')">Offers</a></li>
        <li><a href="#springUrl('/plans.do')">Plan Details</a></li>
        <li><a href="#springUrl('/logout.do')"><i class="icon-off icon-black"></i>Logout</a></li>
    </ul>
    
	<h3>Usage Statistics</h3>

	<ul class="nav nav-tabs span">
		<li><a href="#springUrl('/billingHistoryChart.do')">Billing History</a></li>
        <li><a href="#springUrl('/minuteDataUsageChart.do')">Minutes & Data Usage</a></li>
    </ul>
    
    <form id="billingHistoryChartFrm" action="#springUrl('/billingHistoryData.do')" method="post">
    	<div id="error" style="color: green;"></div>
		<div id="container" style="min-width: 400px; max-width: 800px; height: 400px; margin: 0 auto"></div>
		<input type="hidden" id="monthlyBillURL" value="#springUrl('/monthlyItemisedBill')" />
    </form>

	</body>
</html>
